# ğŸš€ Bootstrap Plan Overview

**Generated by:** Claude (claude-sonnet-4-5-20250929)
**Date:** 2025-11-08
**Status:** Living document - will evolve as we learn

---

## What We're Building

A production-quality Bevy plugin that enables games to embed real, interactive terminal sessions using a **render-to-texture** architecture. Players can interact with in-game computers to run shells, editors (nvim), and development tools (Claude Code) - all within the game world.

**Creative Vision:** Imagine a character named Claude with a CRT-shaped head displaying real Claude Code. When you approach and interact, the view zooms smoothly from the tiny CRT screen to fullscreen terminal interaction. The terminal is always running in the background - Claude Code keeps working even when you're not looking!

Originally created for the "Endgame of SRE" game, but designed as a reusable plugin.

## Core Architecture: Render-to-Texture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Bevy Terminal Plugin                   â”‚
â”‚                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ PTY (persistent, always running) â”‚     â”‚ â† Spawned at startup
â”‚  â”‚    â†“                              â”‚     â”‚
â”‚  â”‚ alacritty_terminal::Term          â”‚     â”‚ â† Always updating
â”‚  â”‚    â†“                              â”‚     â”‚
â”‚  â”‚ Render Grid â†’ Image Texture      â”‚     â”‚ â† High-quality rendering
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚               â†“                            â”‚
â”‚      Handle<Image> exposed                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â†“
         Your Game Uses It
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Sprite (tiny on CRT head, scale 0.05)     â”‚
â”‚  Sprite (fullscreen, scale 1.0)            â”‚
â”‚  With CRT shader effects (optional)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Key Benefits:**
- âœ… Single draw call per terminal
- âœ… Easy scaling (tiny â†” fullscreen)
- âœ… Multiple views of same terminal
- âœ… Simple game integration (just use the texture handle)
- âœ… Persistent state (terminals run 24/7)

## Design Principles

### Quality First
- **Rendering:** Optimize for visual quality over resource usage
- **Performance:** Fast enough for live demos (60-120 Hz refresh)
- **Typography:** Crisp, beautiful text using generous VRAM/GPU
- **No compromises:** Simple game, powerful hardware expected

### Hardcoded MVP â†’ Configurable Later
- **Now:** Hardcode font, size, colors for fast iteration
- **Later:** Refactor to configurable plugin options
- **Philosophy:** Get it working beautifully first, then add flexibility

### Architecture: Design for Future, Implement Minimal
- **Design for:** Multiple terminals, ligatures, emoji, wide chars
- **Implement:** Single terminal, basic ASCII + box-drawing
- **Benefit:** Clean architecture from day one, features when needed

## Technical Decisions

### PTY Lifecycle
**Persistent from startup:**
- PTYs spawn when plugin initializes (Startup system)
- Terminal state always updates in background
- Shell/processes run continuously
- "Opening" terminal = show UI, "closing" = hide UI
- State persists across open/close cycles
- Near-instant open (no spawn delay)

### Rendering States
1. **Hidden** - Terminal updating, no texture rendering
2. **Minimized** - Render to texture, display tiny (CRT head sprite)
3. **Fullscreen** - Render to texture, display as UI overlay

### Async I/O Priority
1. Bevy's task pool / async runtime (if suitable)
2. Alacritty's patterns for PTY I/O
3. Tokio as fallback

### Font Rendering
- **Font:** Cascadia Mono (bundled in assets/)
- **Atlas size:** 4096x4096 or larger for quality
- **Pre-render:** ASCII (32-126), box-drawing (U+2500-257F), blocks (U+2580-259F)
- **On-demand:** Extended Unicode as needed
- **Future:** Ligatures, emoji, wide characters

## Bootstrap Phases

### Phase 0: Project Setup â³
- [x] Initial documentation
- [ ] Cargo workspace initialization
- [ ] Basic project structure
- [ ] Font asset acquisition
- [ ] CI/CD configuration
- [ ] Development tooling

### Phase 1: Terminal Backend ğŸ“¡
- [ ] Plugin skeleton (hardcoded config)
- [ ] alacritty_terminal integration
- [ ] Persistent PTY with portable-pty (Startup system)
- [ ] Continuous PTY polling and grid updates
- [ ] Keyboard input capture (when active)

### Phase 2: Font & Atlas ğŸ”¤
- [ ] Cascadia Mono loading
- [ ] High-quality glyph rasterization
- [ ] Large atlas generation (4096x4096+)
- [ ] Precise metrics calculation
- [ ] Static rendering test

### Phase 3: Render-to-Texture ğŸ¨
- [ ] Create Image texture resource
- [ ] Render grid to pixel buffer
- [ ] Upload to GPU texture
- [ ] Expose Handle<Image> via resource
- [ ] Incremental dirty region updates
- [ ] Color modulation (Tokyo Night)

### Phase 4: Game Integration ğŸ®
- [ ] Example: Claude character with CRT head
- [ ] Zoom interaction system
- [ ] Input routing (active/inactive modes)
- [ ] Smooth camera transitions
- [ ] Polish and effects

## MVP Scope

**In Scope:**
- Single terminal (architecture supports multiple)
- Persistent PTY (bash/zsh) spawned at startup
- Render-to-texture with high-quality font rendering
- Keyboard input when terminal active
- Expose `Handle<Image>` for game use
- Tokyo Night colors (hardcoded)
- Example showing tiny CRT head â†’ fullscreen zoom

**Designed For (Implement Later):**
- Multiple concurrent terminals
- Font ligatures
- Emoji and wide characters
- Runtime configuration
- Scrollback buffer
- Copy/paste
- Dynamic resizing
- Published as separate crate

## Success Criteria

Bootstrap phase complete when:

1. âœ… Cargo project builds successfully
2. âœ… Plugin spawns PTY at startup
3. âœ… Terminal renders to texture with crisp font
4. âœ… Example shows tiny sprite (CRT head concept)
5. âœ… Can zoom to fullscreen and type commands
6. âœ… Terminal state persists when hidden
7. âœ… Rendering quality suitable for live demos
8. âœ… CI pipeline validates builds

## Questions Answered

Based on our discussion:

1. âœ… **Font bundling:** Bundle Cascadia Mono in assets/
2. âœ… **Atlas size:** 4096x4096+ for quality
3. âœ… **Update frequency:** 60-120 Hz for live demo quality
4. âœ… **Async I/O:** Bevy â†’ Alacritty â†’ Tokio priority
5. âœ… **PTY lifecycle:** Start at plugin init, persistent
6. âœ… **UI lifecycle:** Show/hide doesn't affect PTY
7. âœ… **Multiple instances:** Design for it, implement single
8. âœ… **Configuration:** Hardcode initially
9. âœ… **Ligatures/emoji:** Design for it, implement post-MVP
10. âœ… **Rendering:** Render-to-texture for flexibility

## Planning Documents

- **00-overview.md** â† You are here
- **01-project-initialization.md** - Cargo setup and structure
- **02-dependencies.md** - Crate dependencies and versions
- **03-implementation-roadmap.md** - Detailed phase breakdown
- **04-font-rendering.md** - High-quality font system
- **05-testing-strategy.md** - Testing and validation
- **06-workflow.md** - Development practices
- **07-integration-checklist.md** - Completion criteria

## Use Case Example

```rust
// In ~/src/sregame/main.rs
fn spawn_claude_character(
    mut commands: Commands,
    terminal_texture: Res<TerminalTexture>,  // From plugin
) {
    commands.spawn((
        Sprite::from_image(terminal_texture.handle.clone()),
        Transform::from_xyz(100.0, 200.0, 0.0)
            .with_scale(Vec3::splat(0.05)), // Tiny CRT head!
        ClaudeCharacter,
    ));
}

// Press 'E' near Claude â†’ zoom to fullscreen â†’ interact
// Walk away â†’ zoom back to tiny CRT head
// Terminal keeps running Claude Code in background
```

---

**Philosophy:** Beautiful, responsive terminal rendering in a game world. Quality over resource constraints. Persistent state for seamless interaction. Hardcode for speed, refactor for flexibility.
