# ğŸ› ï¸ Development Workflow Guide

**Generated by:** Claude (claude-sonnet-4-5-20250929)
**Date:** 2025-11-08
**Status:** Daily practices

---

## Daily Development Cycle

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. Check jj log (read context)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. Create new jj change (atomic work)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. Implement & test iteratively         â”‚
â”‚    - Write code                          â”‚
â”‚    - Run tests                           â”‚
â”‚    - Manual verification                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. Update jj description (document)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. Verify quality (clippy, fmt, build)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. Push when ready (tests pass)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Jujutsu (jj) Workflow

### Session Start

```bash
# Check recent work and context
jj log -r 'mine()' -n 5

# Read latest change description
jj show @

# Check current state
jj status
```

### Starting New Work

```bash
# Create new change with clear intent
jj new -m "feat: Implement PTY lifecycle management"

# Or shorter
jj new -m "fix: Handle missing font file gracefully"
```

**Change Types:**
- `feat:` New feature
- `fix:` Bug fix
- `refactor:` Code restructuring
- `test:` Test additions
- `docs:` Documentation
- `chore:` Project maintenance

### During Development

```bash
# Make changes, test iteratively
cargo build
cargo run --example claude_crt
cargo test

# Check what changed
jj diff

# Amend as you go (changes are mutable)
# (automatic - just keep working)
```

### Updating Description

```bash
# Add detailed description
jj describe

# Editor opens with template:
```

```
feat: Implement PTY lifecycle management

Why: Need persistent PTY for terminal that runs continuously
Approach:
- Spawn PTY in Startup system using portable-pty
- Store reader/writer in PtyResource
- Poll in Update system with non-blocking read
- Handle process exit gracefully

Status: Complete - PTY spawns and receives data

Co-authored-by: Claude <claude@anthropic.com>
```

**Description Guidelines:**
- **Why:** Problem being solved
- **Approach:** Key decisions, patterns used
- **Status:** complete | in-progress | next: remaining work
- **Co-authored-by:** Always include for agent work

### Before Pushing

```bash
# Quality checks
cargo fmt --check
cargo clippy --all-targets -- -D warnings
cargo test
cargo build --example claude_crt

# All good? Push!
jj git push -c @
```

### Viewing History

```bash
# Recent changes
jj log -r 'mine()' -n 10

# Full diff of a change
jj show <change-id>

# Evolution of current change
jj obslog

# Pretty graph
jj log --graph -r 'all()'
```

### Fixing Mistakes

```bash
# Undo working copy changes
jj restore

# Abandon current change
jj abandon

# Split change into multiple
jj split

# Squash fixup commits
jj squash -i
```

## Code Quality Commands

### Essential Checks

```bash
# Format code
cargo fmt

# Check formatting
cargo fmt --check

# Lint with clippy
cargo clippy --all-targets -- -D warnings

# Build everything
cargo build --all

# Run tests
cargo test

# Build examples
cargo build --examples
```

### Combined Check Script

```bash
#!/bin/bash
# scripts/check.sh - Run all quality checks

set -e

echo "ğŸ”§ Formatting..."
cargo fmt --check

echo "ğŸ“ Clippy..."
cargo clippy --all-targets -- -D warnings

echo "ğŸ—ï¸  Building..."
cargo build --all

echo "ğŸ§ª Testing..."
cargo test

echo "ğŸ“¦ Examples..."
cargo build --examples

echo "âœ… All checks passed!"
```

```bash
# Run before pushing
bash scripts/check.sh
```

## Running Examples

### Basic Run

```bash
# Run claude_crt example
cargo run --example claude_crt

# With release optimizations
cargo run --release --example claude_crt

# With logging
RUST_LOG=debug cargo run --example claude_crt
RUST_LOG=bevy_terminal=trace cargo run --example claude_crt
```

### Quick Iteration

```bash
# Use alias from .cargo/config.toml
cargo ex claude_crt

# Watch for changes and rebuild
cargo install cargo-watch
cargo watch -x 'run --example claude_crt'
```

## Debugging Workflow

### Enable Logging

```rust
// In code
use log::{debug, info, warn, error};

info!("PTY spawned successfully");
debug!("Received {} bytes from PTY", n);
error!("Failed to create texture: {}", e);
```

```bash
# At runtime
RUST_LOG=info cargo run --example claude_crt
RUST_LOG=debug cargo run --example claude_crt
RUST_LOG=bevy_terminal::pty=trace cargo run --example claude_crt
```

### Debug Builds vs Release

```bash
# Debug (default) - fast compile, slow runtime
cargo build

# Release - slow compile, fast runtime
cargo build --release

# Debug optimized (good middle ground)
# Already configured in Cargo.toml:
# [profile.dev]
# opt-level = 1
```

### Using `rust-gdb` / `lldb`

```bash
# Build with debug symbols
cargo build

# Debug with gdb (Linux)
rust-gdb target/debug/examples/claude_crt

# Debug with lldb (macOS)
rust-lldb target/debug/examples/claude_crt
```

### Bevy Diagnostics

```rust
// Add to example for performance metrics
use bevy::diagnostic::{FrameTimeDiagnosticsPlugin, LogDiagnosticsPlugin};

App::new()
    .add_plugins(DefaultPlugins)
    .add_plugins(FrameTimeDiagnosticsPlugin)
    .add_plugins(LogDiagnosticsPlugin::default())
    .add_plugins(TerminalPlugin)
    .run();
```

## Incremental Development

### Phased Implementation

**Don't try to do everything at once!**

Example: Implementing render-to-texture

1. **Stub:** Create empty system
   ```rust
   fn render_terminal_grid() {
       info!("TODO: Render grid");
   }
   ```
   - âœ… Compiles, runs
   - âœ… Commit: "feat: Add render_terminal_grid system stub"

2. **Skeleton:** Basic structure
   ```rust
   fn render_terminal_grid(
       term: Res<TerminalState>,
       texture: Res<TerminalTexture>,
   ) {
       info!("Grid has {} rows", term.size.rows);
   }
   ```
   - âœ… Resources accessed
   - âœ… Commit: "feat: Wire up terminal grid renderer resources"

3. **MVP Implementation:** Core functionality
   ```rust
   fn render_terminal_grid(...) {
       // Actual blitting code
   }
   ```
   - âœ… Actually renders
   - âœ… Commit: "feat: Implement terminal grid rendering to texture"

4. **Optimization:** Improve performance
   ```rust
   // Add dirty region tracking
   ```
   - âœ… Faster
   - âœ… Commit: "perf: Add dirty region tracking to renderer"

### Testing Each Step

After each change:
```bash
cargo build           # Must compile
cargo run --example claude_crt  # Must run
jj diff               # Review changes
jj describe           # Update description
```

## Collaboration Workflow

### Working with Other Agents

**Gemini, Kimi, or other agents might contribute.**

When taking over from another agent:

```bash
# Read their work
jj log -r 'mine()' -n 5
jj show <their-change-id>

# Understand context from description
# Continue in new change
jj new -m "feat: Continue PTY work (Claude)"
```

When handing off:

```bash
# Write detailed description
jj describe

# Include:
# - What works
# - What doesn't
# - Next steps
# - Gotchas/discoveries
```

### Human Collaboration

**Ask questions!**

When uncertain:
- Ask about design decisions
- Clarify requirements
- Request code review
- Suggest alternatives

**Provide feedback:**
- "This approach might be slower because..."
- "Consider using X instead of Y for better..."
- "This conflicts with the design doc - should we update?"

## Productivity Tips

### Fast Iteration

```bash
# Terminal 1: Watch and rebuild
cargo watch -x 'build --example claude_crt'

# Terminal 2: Run manually
cargo run --example claude_crt

# Terminal 3: Tests
cargo watch -x test
```

### Editor Integration

**rust-analyzer:**
- Shows errors inline
- Auto-completion
- Jump to definition
- Inline type hints

**VS Code:** rust-analyzer extension
**Neovim:** rust-analyzer via LSP
**Helix:** rust-analyzer built-in

### Keyboard Shortcuts

Learn your editor's shortcuts for:
- Format on save
- Run clippy
- Jump to definition
- Rename symbol
- Show documentation

## Common Pitfalls

### âŒ Don't

- **Don't** use `unwrap()` (use `?` or `expect()`)
- **Don't** ignore clippy warnings
- **Don't** skip `cargo fmt`
- **Don't** commit broken code
- **Don't** make giant changes (atomic commits!)
- **Don't** forget to update descriptions

### âœ… Do

- **Do** run checks before pushing
- **Do** write clear commit messages
- **Do** test changes manually
- **Do** add context with `.context()`
- **Do** break work into small changes
- **Do** ask questions when uncertain

## Emergency Recovery

### Build Broken

```bash
# Clean everything
cargo clean

# Rebuild
cargo build

# Still broken? Check dependencies
cargo update
```

### Jujutsu Confusion

```bash
# Check status
jj status

# View recent changes
jj log

# Abandon current mess
jj abandon

# Start fresh
jj new -m "Start over cleanly"
```

### Git Integration Issues

```bash
# Check git status
jj git status

# Fetch latest
jj git fetch

# Push specific change
jj git push -c <change-id>
```

## Daily Checklist

**Morning:**
- [ ] `jj log` to see latest work
- [ ] Read recent change descriptions
- [ ] Plan today's task

**During work:**
- [ ] `jj new` for each logical change
- [ ] Test frequently (`cargo build`, `cargo run`)
- [ ] Update `jj describe` as you learn

**Before pushing:**
- [ ] `bash scripts/check.sh` (fmt, clippy, test, build)
- [ ] Manual smoke test
- [ ] Review `jj diff`
- [ ] Ensure description is complete
- [ ] `jj git push -c @`

**End of day:**
- [ ] Push all completed work
- [ ] Update jj descriptions with next steps
- [ ] Document any blockers or questions

---

**Remember:** Small, atomic changes with clear descriptions. Test frequently. Ask questions. Have fun! ğŸ®
